# Story: 2.1 - Implement Job Listing Creation & Management

**Status:** Draft
**Epic:** 2 - Job Management
**Story Points:** 8
**Priority:** High
**Assigned To:** [Unassigned]

## Story Statement

As a Company user, I want to create comprehensive job listings with detailed fields so that I can accurately represent roles and attract qualified candidates while maintaining consistent job posting standards across the organization.

## Acceptance Criteria

- [ ] Company users can create job listings with all required fields
- [ ] Job listings include title, description, responsibilities, requirements, location, salary range, employment type, and application deadline
- [ ] Rich text editing for job descriptions and requirements
- [ ] Job listings can be saved as drafts before publishing
- [ ] Company users can edit existing job listings
- [ ] Job listings can be closed/reopened as needed
- [ ] Form validation ensures all required fields are completed
- [ ] Job listings are properly formatted and professional

## Technical Requirements

### Reference Implementation Adaptation

**üìÅ Reference Repository:** `docs/reference-repos/job-marshal-finale-locale-main`

**üîß Implementation Strategy:** Copy and adapt 85%+ of the reference job management system for PayloadCMS integration.

### Key Reference Components to Adapt

#### 1. Job Creation Form

**Reference:** `components/jobs/JobForm.tsx` or similar job creation components
**Target:** `src/components/jobs/JobListingForm.tsx`

```typescript
// Copy existing job form with React Hook Form + Zod validation
// Replace Prisma mutations with PayloadCMS API calls
// Add draft/publish workflow
// Maintain existing rich text editing functionality
```

#### 2. Job Management Pages

**Reference:** `app/jobs/` directory with job management pages
**Target:** `src/app/[locale]/jobs/manage/page.tsx`

```typescript
// Adapt existing job management interface
// Add internationalization support
// Update routing for HR dashboard
```

#### 3. Job Status Management

**Reference:** Job status patterns in the reference codebase
**Target:** `src/components/jobs/JobStatusManager.tsx`

```typescript
// Copy existing status management patterns
// Adapt for PayloadCMS workflow
// Add HR-specific permissions
```

#### 4. Rich Text Editor

**Reference:** Rich text editing components in forms
**Target:** `src/components/jobs/RichTextEditor.tsx`

```typescript
// Copy existing rich text editor implementation
// Adapt for PayloadCMS rich text fields
// Maintain formatting and validation
```

### API Integration

**Replace Prisma with PayloadCMS:**

```typescript
// BEFORE (Prisma)
const job = await prisma.job.create({
  data: formData,
});

// AFTER (PayloadCMS)
const response = await fetch("/api/jobs", {
  method: "POST",
  body: JSON.stringify(formData),
});
```

**Rich Text Handling:**

```typescript
// BEFORE (Prisma JSON)
description: richTextData;

// AFTER (PayloadCMS)
description: {
  root: richTextData;
}
```

### External API Data Consumption Requirements

**Job Management API Endpoints:**

- `GET /api/jobposts` - List jobs (with HR filtering)
- `POST /api/jobposts` - Create new job listing
- `GET /api/jobposts/:id` - Get job details
- `PUT /api/jobposts/:id` - Update job listing
- `PATCH /api/jobposts/:id/status` - Update job status (assumed)
- `GET /api/companies` - List companies
- `POST /api/companies` - Create company profile

**Expected API Response Fields (Confirmed from API Test):**

**Jobs Response:**

```typescript
interface Job {
  id: string;
  jobTitle: string; // Confirmed: Job title
  employmentType: string; // Confirmed: Job type
  location: string; // Confirmed: Location
  salaryFrom: number | null; // Confirmed: Salary range
  salaryTo: number | null; // Confirmed: Salary range
  jobDescription: { root: any }; // Confirmed: Rich text description
  listingDuration: number; // Confirmed: Duration
  benefits: string[]; // Confirmed: Benefits array
  status: "DRAFT" | "ACTIVE" | "CLOSED"; // Confirmed: Status
  applications: number; // Confirmed: Application count
  company: Company; // Confirmed: Nested company object
  updatedAt: string;
  createdAt: string;
}
```

**Companies Response:**

```typescript
interface Company {
  id: string;
  name: string; // Confirmed: Company name
  location: string; // Confirmed: Company location
  logo: string | null; // Confirmed: Logo URL
  website: string | null; // Confirmed: Website URL
  xAccount: string | null; // Confirmed: X/Twitter account
  about: string | null; // Confirmed: Company description
  user: string | User; // Confirmed: User relationship (ID or nested)
  updatedAt: string;
  createdAt: string;
}
```

**Fields to Pull from External API:**

- **Jobs:** `id`, `jobTitle`, `employmentType`, `location`, `salaryFrom`, `salaryTo`, `jobDescription`, `listingDuration`, `benefits`, `status`, `applications`, `company`, `updatedAt`, `createdAt`
- **Companies:** `id`, `name`, `location`, `logo`, `website`, `xAccount`, `about`, `user`, `updatedAt`, `createdAt`

**API Request Patterns:**

```typescript
// GET jobs with filters
const response = await fetch("https://issi-dashboard-payloadcms.vercel.app/api/jobposts?page=1&limit=10", {
  headers: { Authorization: `Bearer ${token}` },
});
const { docs: jobs, totalDocs, totalPages, hasNextPage } = await response.json();

// POST new job
const response = await fetch("https://issi-dashboard-payloadcms.vercel.app/api/jobposts", {
  method: "POST",
  headers: {
    Authorization: `Bearer ${token}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify(jobData),
});
const newJob = await response.json();

// GET companies
const response = await fetch("https://issi-dashboard-payloadcms.vercel.app/api/companies?page=1&limit=10");
const { docs: companies } = await response.json();

// POST new company
const response = await fetch("https://issi-dashboard-payloadcms.vercel.app/api/companies", {
  method: "POST",
  headers: {
    Authorization: `Bearer ${token}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify(companyData),
});
const newCompany = await response.json();
```

**Adapt from Reference:**

- Copy `CreateJobForm.tsx` with existing validation
- Use external API endpoints for job/company CRUD
- Map API response fields to form components

### Internationalization

**URL Structure:**

- English: `/jobs/manage`, `/jobs/create`
- Spanish: `/trabajos/gestionar`, `/trabajos/crear`
- French: `/emplois/gerer`, `/emplois/creer`

### File Structure (Adapted from Reference)

```
src/
‚îú‚îÄ‚îÄ app/[locale]/
‚îÇ   ‚îú‚îÄ‚îÄ jobs/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manage/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                # HR job management dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                # Job creation page
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [id]/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ edit/
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx            # Job editing page
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx                # Job details page
‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx                      # Locale-aware layout
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ jobs/
‚îÇ       ‚îú‚îÄ‚îÄ JobListingForm.tsx          # Adapted from reference JobForm.tsx
‚îÇ       ‚îú‚îÄ‚îÄ JobStatusManager.tsx        # Adapted from reference status patterns
‚îÇ       ‚îú‚îÄ‚îÄ RichTextEditor.tsx          # Adapted from reference rich text components
‚îÇ       ‚îú‚îÄ‚îÄ JobPreview.tsx              # Adapted from reference preview components
‚îÇ       ‚îî‚îÄ‚îÄ JobList.tsx                 # Adapted from reference job listing components
‚îî‚îÄ‚îÄ lib/
    ‚îî‚îÄ‚îÄ api/
        ‚îî‚îÄ‚îÄ jobs.ts                     # New: Job management API functions
```

## Implementation Tasks

### Phase 1: Job Creation (Adapted from Reference)

1. **Adapt Job Creation Form**

   - Copy JobForm from reference
   - Update for PayloadCMS API integration
   - Add draft/publish workflow
   - Maintain React Hook Form + Zod validation

2. **Create Job Management Dashboard**

   - Adapt existing job management interface
   - Add company-specific filtering and actions
   - Implement status management controls

3. **Implement Rich Text Editing**
   - Adapt existing rich text editor
   - Replace with PayloadCMS rich text
   - Add formatting and validation

### Phase 2: Job Management Features

4. **Add Job Status Management**

   - Implement draft/active/closed workflow
   - Add status transition validation
   - Create status change notifications

5. **Create Job Preview System**

   - Adapt existing preview components
   - Add public view simulation
   - Implement mobile responsiveness check

6. **Implement Company Profile Integration**
   - Link jobs to company profiles
   - Enable company information display
   - Add company-specific job management

## Dependencies

- Story 1.1: User Authentication & Role Management
- Reference Repository: `docs/reference-repos/job-marshal-finale-locale-main`
- PayloadCMS rich text functionality
- React Hook Form + Zod validation (from reference)

### Upcoming Stories (Anticipated Based on Patterns)

- **Job Detail Pages**: Consume `GET /api/jobposts/{id}`; pull detailed job fields (same as above).
- **Application Management**: Consume `POST /api/savedjobposts`, `GET /api/savedjobposts`; pull application status, saved jobs.
- **Company Profiles**: Consume `GET /api/companies/{id}`; pull detailed company fields (same as above).
- **Admin Dashboard**: Consume admin-specific endpoints; pull user/job management fields.
