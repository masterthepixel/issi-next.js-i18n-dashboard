# Story: 1.2 - Implement Job Seeker Profile Management

**Status:** Draft
**Epic:** 1 - User Management & Authentication
**Story Points:** 5
**Priority:** High
**Assigned To:** [Unassigned]

## Story Statement

As a job seeker, I want to create and manage my profile with personal information, work experience, education, skills, and resume upload so that I can present myself effectively to potential employers and track my job search progress.

## Acceptance Criteria

- [ ] Job seekers can create a comprehensive profile with personal information
- [ ] Users can upload and manage their resume (PDF, DOCX, max 5MB)
- [ ] Profile includes work experience, education, and skills sections
- [ ] Users can edit and update their profile information
- [ ] Profile data is securely stored and accessible only to authorized users
- [ ] Resume files are properly validated for type and size
- [ ] Users can view their application history and status
- [ ] Profile completion progress is shown to encourage full profiles

## Technical Requirements

### Reference Implementation Adaptation

**üìÅ Reference Repository:** `docs/reference-repos/job-marshal-finale-locale-main`

**üîß Implementation Strategy:** Copy and adapt 85%+ of the reference onboarding system for PayloadCMS integration.

### Key Reference Components to Adapt

#### 1. Job Seeker Onboarding Form

**Reference:** `components/forms/onboarding/JobSeekerForm.tsx`
**Target:** `src/components/profile/JobSeekerProfileForm.tsx`

```typescript
// Copy existing JobSeekerForm with React Hook Form + Zod validation
// Replace Prisma mutations with PayloadCMS API calls
// Add profile completion tracking
// Maintain existing file upload functionality
```

#### 2. Onboarding Page

**Reference:** `app/onboarding/page.tsx`
**Target:** `src/app/[locale]/profile/setup/page.tsx`

```typescript
// Adapt existing onboarding flow
// Add internationalization support
// Update routing for profile setup
```

#### 3. File Upload Components

**Reference:** UploadThing integration in forms
**Target:** `src/components/profile/ResumeUpload.tsx`

```typescript
// Copy existing file upload patterns
// Adapt for PayloadCMS media uploads
// Maintain file validation and security
```

#### 4. User Profile Management

**Reference:** Profile-related patterns in the codebase
**Target:** `src/app/[locale]/profile/page.tsx`

```typescript
// Create profile management page
// Adapt existing form patterns for editing
// Add profile completion indicators
```

### API Integration

**Replace Prisma with PayloadCMS:**

```typescript
// BEFORE (Prisma)
const profile = await prisma.jobSeekerProfile.create({
  data: formData,
});

// AFTER (PayloadCMS)
const response = await fetch("/api/jobseekers", {
  method: "POST",
  body: JSON.stringify(formData),
});
```

**File Upload Pattern:**

```typescript
// BEFORE (UploadThing)
const { fileUrl } = await uploadFiles({ files: [file] });

// AFTER (PayloadCMS)
const formData = new FormData();
formData.append("file", file);
const response = await fetch("/api/media", {
  method: "POST",
  body: formData,
});
```

### External API Data Consumption Requirements

**Job Seeker Profile API Endpoints:**

- `GET /api/jobseekers/me` - Get current user's profile (assumed)
- `POST /api/jobseekers` - Create job seeker profile (assumed)
- `PUT /api/jobseekers/me` - Update job seeker profile (assumed)
- `POST /api/upload/resume` - Upload resume file (assumed)

**Expected API Response Fields (Based on User Object from API Test):**

**Job Seeker Profile Response:**

```typescript
interface JobSeeker {
  id: string;
  name: string; // Confirmed from user object: Display name
  about?: string; // Not confirmed: Bio/description (gap)
  resume?: string; // Not confirmed: Resume file URL (gap)
  userId: string; // Confirmed from user object: User relationship
  userType: "JOB_SEEKER"; // Confirmed: Role type
  onboardingCompleted: boolean; // Confirmed: Completion status
  email: string; // Confirmed: User email
  updatedAt: string;
  createdAt: string;
}
```

**Fields to Pull from External API:**

- `id` (profile ID)
- `name` (display name)
- `about` (bio/description - gap: not confirmed in API)
- `resume` (resume URL - gap: not confirmed, assume FormData upload)
- `userId` (user relationship)
- `userType` (confirm JOB_SEEKER)
- `onboardingCompleted` (profile completion)
- `email` (user email)
- `updatedAt`, `createdAt` (timestamps)

**Gaps Identified:** `about` and `resume` fields not visible in tested API. May require separate endpoints or file upload handling.

**API Request/Response Patterns:**

```typescript
// Get profile data (assumed endpoint)
const response = await fetch("https://issi-dashboard-payloadcms.vercel.app/api/jobseekers/me", {
  headers: { Authorization: `Bearer ${token}` },
});
const profile = await response.json();

// Update profile (assumed)
const response = await fetch("https://issi-dashboard-payloadcms.vercel.app/api/jobseekers/me", {
  method: "PUT",
  headers: {
    Authorization: `Bearer ${token}`,
    "Content-Type": "application/json",
  },
  body: JSON.stringify(profileData),
});
const updatedProfile = await response.json();

// Upload resume (assumed - use FormData)
const formData = new FormData();
formData.append("resume", file);
const response = await fetch("https://issi-dashboard-payloadcms.vercel.app/api/upload/resume", {
  method: "POST",
  headers: { Authorization: `Bearer ${token}` },
  body: formData,
});
const { resumeUrl } = await response.json();
```

**Adapt from Reference:**

- Copy `JobSeekerForm.tsx` with existing validation
- Adapt file upload to external API endpoints
- Use external API for profile CRUD operations
- Map API response fields to component state

### Internationalization

**URL Structure:**

- English: `/profile/setup`, `/profile`
- Spanish: `/perfil/configuracion`, `/perfil`
- French: `/profil/configuration`, `/profil`

### File Structure (Adapted from Reference)

```
src/
‚îú‚îÄ‚îÄ app/[locale]/
‚îÇ   ‚îú‚îÄ‚îÄ profile/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                    # Profile management page
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ setup/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx                # Profile setup/onboarding
‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx                      # Locale-aware layout
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ profile/
‚îÇ       ‚îú‚îÄ‚îÄ JobSeekerProfileForm.tsx    # Adapted from reference JobSeekerForm.tsx
‚îÇ       ‚îú‚îÄ‚îÄ ResumeUpload.tsx            # Adapted from reference upload patterns
‚îÇ       ‚îú‚îÄ‚îÄ ProfileCompletion.tsx       # New: Completion tracking
‚îÇ       ‚îî‚îÄ‚îÄ ApplicationHistory.tsx      # New: Application tracking
‚îî‚îÄ‚îÄ lib/
    ‚îî‚îÄ‚îÄ api/
        ‚îî‚îÄ‚îÄ profile.ts                  # New: Profile API functions
```

## Implementation Tasks

### Phase 1: Profile Setup (Onboarding)

1. **Adapt Job Seeker Form**

   - Copy JobSeekerForm from reference
   - Update for PayloadCMS API integration
   - Add profile completion tracking
   - Maintain React Hook Form + Zod validation

2. **Create Profile Setup Page**

   - Adapt onboarding page structure
   - Add internationalization support
   - Implement step-by-step profile creation

3. **Implement File Upload**
   - Adapt existing upload patterns
   - Replace UploadThing with PayloadCMS media
   - Add file validation and security

### Phase 2: Profile Management

4. **Create Profile Management Page**

   - Build profile editing interface
   - Add profile completion indicators
   - Implement save/update functionality

5. **Add Profile Completion Tracking**

   - Calculate completion percentage
   - Show progress indicators
   - Provide completion suggestions

6. **Implement Application History**
   - Create application tracking component
   - Connect to future application system
   - Add filtering and sorting

## Dependencies

- Story 1.1: User Authentication & Role Management
- Reference Repository: `docs/reference-repos/job-marshal-finale-locale-main`
- PayloadCMS media upload system
- React Hook Form + Zod validation (from reference)

### Upcoming Stories (Anticipated Based on Patterns)

- **Job Detail Pages**: Consume `GET /api/jobposts/{id}`; pull detailed job fields (same as 2.1/3.1).
- **Application Management**: Consume `POST /api/savedjobposts`, `GET /api/savedjobposts`; pull application status, saved jobs.
- **Company Profiles**: Consume `GET /api/companies/{id}`; pull detailed company fields (same as 2.1).
- **Admin Dashboard**: Consume admin-specific endpoints; pull user/job management fields.
